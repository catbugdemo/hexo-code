---
title: 单元测试
date: 2021-12-01 14:30:32
tags:
---

## 前言

- 单元测试可以有效地测试某个程序模块的行为，是未来重构代码的信心保证。
- 单元测试的测试用例要覆盖常用的输入组合、边界条件和异常。
- 单元测试代码要非常简单，如果测试代码太复杂，那么测试代码本身就可能有bug。
- 单元测试通过了并不意味着程序就没有bug了，但是不通过程序肯定有bug。
<!--more-->
## 单元测试 first 原则

### 1.Fast – 快速

- 快速执行是单测的重要原则，确保单测在秒级甚至毫秒级执行完毕

### 2.Isolated – 隔离

- 好的单测是每个测试用例只关注一个逻辑单元或者代码分支，保证单一职责，这样能更清晰的暴露问题和定位问题
- 每个单测之间不应该产生依赖，
- 测试时不要依赖和修改外部数据或文件等其他共享资源，做到测试前后共享资源数据一致

### 3.Repeatable – 可重复执行

- 单测是可以重复执行的，不能受到外界环境的影响，同一测试用例，即使是在不同的机器，不同的环境中运行多次，每次运行都会产生相同的结果
- 避免隐式输入，不能依赖随机字段如 当前日期，随机数

### 4.Self-verifying – 自我验证

- 单测需要通过断言进行结果验证，即当单测执行完毕之后，用来判断执行结果是否和假设一致，无需人工检查是否执行成功

### 5.Timely & Thorough – 即时，全面

- 理想状态 是 TDD 模式开发 ，但由于项目的紧急性(TDD 测试驱动开发一般无法实现，不要过分追求完美– 会害死自己)
- 不要去想 100% 测试覆盖率 ，**花合理的时间抓出大多数 bug, 要好过穷尽一生抓出所有 bug**
- 考虑到参数的边界，特殊值，正常场景以及异常场景，**保证核心流程是正确的**

## golang 推荐好用的单测工具

- golang 内置 func TestXXX
- assert 自动化测试断言工具 — github.com/stretchr/testify
- ginkgo BDD测试思想 工具 – https://github.com/onsi/ginkgo
- miniredis 缓存模拟工具 – github.com/alicebob/miniredis
- go-sqlmock 模拟工具 – github.com/DATA-DOG/go-sqlmock

## 参考

- https://zhuanlan.zhihu.com/p/387540827

